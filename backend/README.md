# VeriGreen Backend

Backend services for the VeriGreen decentralized forest conservation protocol.

## Overview

This backend provides the core functionality for:

- Downloading Sentinel-2 satellite imagery from AWS S3
- Processing imagery to calculate NDVI (Normalized Difference Vegetation Index)
- Uploading processed tiles to Filecoin via Storacha
- API endpoints for the frontend application

## Project Structure

```
backend/
├── src/
│   ├── sentinel/      # Sentinel-2 data acquisition
│   ├── filecoin/      # Storacha/Filecoin integration
│   ├── ndvi/          # NDVI calculation engine
│   ├── api/           # FastAPI endpoints
│   └── utils/         # Utility functions
├── scripts/           # Test and utility scripts
├── tests/             # Unit and integration tests
└── requirements.txt   # Python dependencies
```

## Setup

1. Install dependencies:

```bash
pip3 install -r requirements.txt
```

2. Copy environment configuration:

```bash
cp env.example .env
# Edit .env with your configuration
```

3. Download satellite data:

```bash
# Make the script executable
chmod +x scripts/download_data.sh

# Download the data
./scripts/download_data.sh
```

## Data Management

### Why Data is Not in Git

The satellite imagery files are excluded from version control for several reasons:

1. **File Size**: Each band file is ~80MB, which would bloat the repository
2. **Binary Files**: JP2 files are binary and don't benefit from git's diff capabilities
3. **Reproducibility**: Data can be regenerated by running the download script
4. **Best Practice**: Large data files should be stored separately from code

### Downloading Data

To download the required Sentinel-2 imagery:

```bash
cd backend
python3 scripts/test_download.py
# or use the convenience script:
./scripts/download_data.sh
```

This will download:

- B04.jp2 (~79MB) - Red band
- B08.jp2 (~81MB) - NIR band

## Sentinel-2 Data Acquisition

The Sentinel-2 download module (`src/sentinel/download.py`) downloads satellite imagery for Sabangau National Park in Central Kalimantan, Indonesia.

### Configuration

- **Tile ID**: 49MCT (covers Sabangau National Park area)
- **Date**: May 1, 2023 (cloud-free imagery)
- **Bands**: B04 (Red) and B08 (NIR) at 10m resolution
- **Coverage**: 10.24km x 10.24km area

### Usage

```python
from src.sentinel.download import download_sentinel_imagery

# Download imagery (saves to data/raw/sentinel/)
files, report = download_sentinel_imagery()

if report['success']:
    print(f"Downloaded {len(files)} files")
    for file in files:
        print(f"  - {file}")
```

### Testing

Run the download test:

```bash
python3 scripts/test_download.py
```

## Data Storage

Downloaded data is stored in:

- `data/raw/sentinel/` - Raw Sentinel-2 bands
- `data/processed/` - Processed tiles and NDVI results

## API Development (Coming Soon)

The API will provide endpoints for:

- Tile upload and processing
- NDVI calculation results
- Filecoin storage status
- Merkle tree generation

## Environment Variables

See `env.example` for required configuration:

- API host/port settings
- Redis connection details
- Storacha API credentials (when available)
- Data directory paths

## Dependencies

Key dependencies:

- `boto3` - AWS S3 access
- `rasterio` - Geospatial data processing
- `numpy` - Numerical computations
- `fastapi` - API framework
- `redis` - Caching layer
